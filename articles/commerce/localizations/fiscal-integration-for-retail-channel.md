---
title: Commerce-kanavien kirjanpidon integroinnin yleiskatsaus
description: Tämä ohjeaihe on yleiskatsaus Dynamics 365 Commercein kirjanpidoin integrointitoiminnoista.
author: josaw
manager: annbe
ms.date: 02/01/2019
ms.topic: article
ms.prod: ''
ms.service: dynamics-365-retail
ms.technology: ''
ms.search.form: RetailFunctionalityProfile, RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.search.scope: Core, Operations, Retail
ms.search.region: Global
ms.search.industry: Retail
ms.author: v-kikozl
ms.search.validFrom: 2019-1-16
ms.dyn365.ops.version: 10
ms.openlocfilehash: d2455f775fcf41bbcb1388b2e8053ede8512335d
ms.sourcegitcommit: 199848e78df5cb7c439b001bdbe1ece963593cdb
ms.translationtype: HT
ms.contentlocale: fi-FI
ms.lasthandoff: 10/13/2020
ms.locfileid: "4412065"
---
# <a name="overview-of-fiscal-integration-for-commerce-channels"></a><span data-ttu-id="0bd5f-103">Commerce-kanavien kirjanpidon integroinnin yleiskatsaus</span><span class="sxs-lookup"><span data-stu-id="0bd5f-103">Overview of fiscal integration for Commerce channels</span></span>

[!include [banner](../includes/banner.md)]

## <a name="introduction"></a><span data-ttu-id="0bd5f-104">Johdanto</span><span class="sxs-lookup"><span data-stu-id="0bd5f-104">Introduction</span></span>

<span data-ttu-id="0bd5f-105">Tämä ohjeaihe on yleiskatsaus Dynamics 365 Commercein kirjanpidoin integrointitoiminnoista.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-105">This topic is an overview of the fiscal integration capabilities that are available in Dynamics 365 Commerce.</span></span> <span data-ttu-id="0bd5f-106">Kirjanpidon integrointi sisältää sellaisten erilaisten kirjanpidon laitteiden ja palvelujen integroinnin, joilla kirjanpidon rekisteröinti voidaan ottaa myynnissä käyttöön paikallisten, vähittäismyyntialan veropetoksia estävän kirjanpitolainsäädännön mukaisesti.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-106">Fiscal integration includes integration with various fiscal devices and services that enable fiscal registration of sales in accordance with local fiscal laws that are aimed at preventing tax fraud in the retail industry.</span></span> <span data-ttu-id="0bd5f-107">Kirjanpidon integraatiota voidaan esimerkiksi seuraavissa tyypillisissä skenaarioissa:</span><span class="sxs-lookup"><span data-stu-id="0bd5f-107">Here are some typical scenarios that can be covered by using fiscal integration:</span></span>

- <span data-ttu-id="0bd5f-108">Myynnin rekisteröinti kirjanpidon laitteessa, joka on liitetty myyntipisteeseen (POS), kuten kuittitulostimeen, ja verokuitin tulostaminen asiakkaalle.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-108">Register a sale on a fiscal device that is connected to point of sale (POS), such as a fiscal printer, and print a fiscal receipt for the customer.</span></span>
- <span data-ttu-id="0bd5f-109">Retail POS:ssä suoritettuun myyntiin ja palautuksiin liittyvien tietojen lähettäminen turvallisesti ulkoiseen, veroviranomaisen ylläpitämään verkkopalveluun.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-109">Securely submit information that is related to sales and returns that are completed in Retail POS to an external web-service that is operated by the tax authority.</span></span>
- <span data-ttu-id="0bd5f-110">Myynnin tapahtumatietojen muuttamattomuuden takaaminen digitaalisella allekirjoituksella.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-110">Help guarantee inalterability of sales transaction data through digital signatures.</span></span>

<span data-ttu-id="0bd5f-111">Kirjanpidon integrointitoiminto on kehikko, joka muodostaa yhteisen ratkaisun Retail POS:n sekä kirjanpidoin laitteiden ja palvelujen kehittämiselle ja mukauttamiselle edelleen.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-111">The fiscal integration functionality is a framework that provides a common solution for further development and customization of the integration between Retail POS and fiscal devices and services.</span></span> <span data-ttu-id="0bd5f-112">Toiminto sisältää myös kirjanpidon integrointimalleja, jotka tukevat tiettyjen maiden tai alueiden perusskenaariota ja joita voi käyttää tiettyjen kirjanpidon laitteiden tai palvelujen kanssa.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-112">The functionality also includes fiscal integration samples that support basic scenarios for specific countries or regions, and that work with specific fiscal devices or services.</span></span> <span data-ttu-id="0bd5f-113">Kirjanpidon integrointimalli koostuu useista Commerce-osien laajennuksista, ja se sisältyy SDK:hon.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-113">A fiscal integration sample consists of several extensions of Commerce components and is included in the software development kit (SDK).</span></span> <span data-ttu-id="0bd5f-114">Lisätietoja kirjanpidon integroinnin esimerkeistä on kohdassa [Kirjanpidon integroinnin esimerkit – Retail SDK](#fiscal-integration-samples-in-the-retail-sdk).</span><span class="sxs-lookup"><span data-stu-id="0bd5f-114">For more information about the fiscal integration samples, see [Fiscal integration samples in the Retail SDK](#fiscal-integration-samples-in-the-retail-sdk).</span></span> <span data-ttu-id="0bd5f-115">Lisätietoja Retail SDK:n asentamisesta ja käytöstä on kohdassa [Retail SDK -arkkitehtuuri](../dev-itpro/retail-sdk/retail-sdk-overview.md).</span><span class="sxs-lookup"><span data-stu-id="0bd5f-115">For information about how to install and use the Retail SDK, see [Retail software development kit (SDK) architecture](../dev-itpro/retail-sdk/retail-sdk-overview.md).</span></span>

<span data-ttu-id="0bd5f-116">Jos haluat tukea skenaarioita, joita kirjanpidon integrointimalli ei tue, integroida Retail POS:n muiden kirjanpidon laitteiden ja palvelujen kanssa tai ottaa huomioon muiden maiden tai alueiden vaatimukset, sinun on joko laajennettava nykyistä kirjanpidon integrointimallia tai luotava uusi malli käyttämällä nykyistä mallia esimerkkinä.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-116">To support other scenarios that aren't supported by a fiscal integration sample, to integrate Retail POS with other fiscal devices or services, or to cover requirements of other countries or regions, you must either extend an existing fiscal integration sample or create a new sample by using an existing sample as an example.</span></span>

## <a name="fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices"></a><span data-ttu-id="0bd5f-117">Kirjanpidon rekisteröintiprosessi ja kirjanpidon laitteiden kirjanpidon integrointimallit</span><span class="sxs-lookup"><span data-stu-id="0bd5f-117">Fiscal registration process and fiscal integration samples for fiscal devices</span></span>

<span data-ttu-id="0bd5f-118">Retail POS:n kirjanpidon rekisteröintiprosessissa on vähintään yksi vaihe.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-118">A fiscal registration process in Retail POS can consist of one or more steps.</span></span> <span data-ttu-id="0bd5f-119">Kukin vaihe koskee tiettyjen transaktioiden tai -tapahtumien kirjanpidon rekisteröintiä yhdessä kirjanpidon laitteessa tai palvelussa.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-119">Each step involves fiscal registration of specific transactions or events in one fiscal device or service.</span></span> <span data-ttu-id="0bd5f-120">Seuraavan ratkaisun osat koskevat kirjanpidon rekisteröintiä laiteasemaan yhdistetyssä kirjanpidon laitteessa:</span><span class="sxs-lookup"><span data-stu-id="0bd5f-120">The following solution components participate in the fiscal registration in a fiscal device that is connected to a Hardware station:</span></span>

- <span data-ttu-id="0bd5f-121">**Commerce runtime (CRT) -laajennus** – Tämä osa sarjoittaa transaktion tai tapahtuman tiedot siinä muodossa, jota käytetään myös tiedonsiirtoon kirjanpidon laitteen kanssa, jäsentää vastaukset kirjanpidon laitteesta ja tallentaa vastaukset kanavatietokantaan.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-121">**Commerce runtime (CRT) extension** – This component serializes transaction/event data in the format that is also used for interaction with the fiscal device, parses responses from the fiscal device, and stores the responses in the channel database.</span></span> <span data-ttu-id="0bd5f-122">Lisäksi laajennus määrittää, mitkä transaktiot ja tapahtumat on rekisteröitävä.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-122">The extension also defines the specific transactions and events that must be registered.</span></span> <span data-ttu-id="0bd5f-123">Tätä osa kutsutaan usein *kirjanpitoasiakirjan toimittajaksi*.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-123">This component is often referred to as a *fiscal document provider*.</span></span>
- <span data-ttu-id="0bd5f-124">**Hardware station -laajennus** – Tämä osa käynnistää tiedonsiirron kirjanpidon laitteen kanssa, lähettää pyynnöt ja suorat komennot kirjanpidon laitteeseen kirjanpitoasiakirjasta haettujen transaktion tai tapahtuman tietojen perusteella sekä vastaanottaa vastaukset kirjanpidon laitteesta.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-124">**Hardware station extension** – This component initializes the communication with the fiscal device, sends requests and direct commands to the fiscal device based on the transaction/event data that is extracted from the fiscal document, and receives responses from the fiscal device.</span></span> <span data-ttu-id="0bd5f-125">Tätä osa kutsutaan usein *kirjanpidon yhdistimeksi*.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-125">This component is often referred to as a *fiscal connector*.</span></span>

<span data-ttu-id="0bd5f-126">Kirjanpidon laitteen kirjanpidon integrointimalli sisältää kirjanpitoasiakirjan toimittajan ja kirjanpidon yhdistimen CRT- ja Hardware station -laajennukset.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-126">A fiscal integration sample for a fiscal device contains the CRT and Hardware station extensions for a fiscal document provider and a fiscal connector, respectively.</span></span> <span data-ttu-id="0bd5f-127">Lisäksi se sisältää seuraavien osien määritykset:</span><span class="sxs-lookup"><span data-stu-id="0bd5f-127">It also contains the following component configurations:</span></span>

- <span data-ttu-id="0bd5f-128">**Kirjanpitoasiakirjan toimittajan määritys** – Tämä määritys määrittää kirjanpitoasiakirjojen tulostusmenetelmän ja -muodon.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-128">**Fiscal document provider configuration** – This configuration defines an output method and a format for fiscal documents.</span></span> <span data-ttu-id="0bd5f-129">Lisäksi se sisältää verojen ja maksutapojen tietojen yhdistämisen, jotta Retail POS:n tiedot ovat yhteensopivia kirjanpidon laitteen laiteohjelmassa valmiiksi määritettyjen arvojen kanssa.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-129">It also contains a data mapping for taxes and payment methods, to make data from Retail POS compatible with the values that are predefined in the fiscal device firmware.</span></span>
- <span data-ttu-id="0bd5f-130">**Kirjanpidon yhdistimen määritys** – Tämä määritys määrittää tietyn kirjanpidon laitteen fyysisen tiedonsiirron.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-130">**Fiscal connector configuration** – This configuration defines the physical communication with the specific fiscal device.</span></span>

<span data-ttu-id="0bd5f-131">Tietyn kassakoneen kirjanpidon rekisteröintiprosessi määritetään myyntipisteen toimintaprofiilin vastaavalla asetuksella.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-131">A fiscal registration process for a specific POS register is defined by a corresponding setting in the POS functionality profile.</span></span> <span data-ttu-id="0bd5f-132">Lisätietoja kirjanpidon rekisteröintiprosessin määrittämisestä, kirjanpitoasiakirjan toimittajan ja kirjanpidon yhdistimen määritysten lataamisesta sekä niiden parametrien muuttamisesta on kohdassa [Kirjanpidon rekisteröintiprosessin määrittäminen](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).</span><span class="sxs-lookup"><span data-stu-id="0bd5f-132">For more details about how to configure a fiscal registration process, upload fiscal document provider and fiscal connector configurations, and change their parameters, see [Set up a fiscal registration process](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).</span></span>

<span data-ttu-id="0bd5f-133">Seuraavassa esimerkissä on tyypillinen kirjanpidon laitteen kirjanpidon rekisteröinnin työnkulku.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-133">The following example shows a typical fiscal registration execution flow for a fiscal device.</span></span> <span data-ttu-id="0bd5f-134">Työnkulku alkaa myyntipisteen tapahtumalla (kuten myyntitapahtuman päättämisellä), ja siinä toteutetaan seuraavat vaiheet mainitussa järjestyksessä:</span><span class="sxs-lookup"><span data-stu-id="0bd5f-134">The flow starts with an event in the POS (for example, finalization of a sales transaction) and implements the following sequence of steps:</span></span>

1. <span data-ttu-id="0bd5f-135">Myyntipiste pyytää kirjanpitoasiakirjan CRT:stä.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-135">The POS requests a fiscal document from CRT.</span></span>
2. <span data-ttu-id="0bd5f-136">CRT selvittää, edellyttääkö nykyinen tapahtuma kirjanpidon rekisteröintiä.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-136">CRT determines whether the current event requires fiscal registration.</span></span>
3. <span data-ttu-id="0bd5f-137">CRT tunnistaa kirjanpidon rekisteröintiprosessin asetusten perusteella kirjanpidon rekisteröinnissä käytettävän kirjanpidon yhdistimen ja vastaavan kirjanpitoasiakirjan toimittajan.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-137">Based on the fiscal registration process settings, CRT identifies a fiscal connector and corresponding fiscal document provider to use for the fiscal registration.</span></span>
4. <span data-ttu-id="0bd5f-138">CRT suorittaa kirjanpitoasiakirjan toimittajan, joka luo transaktiota tai tapahtuvaa edustavan kirjanpitoasiakirjan (kuten XML-asiakirjan).</span><span class="sxs-lookup"><span data-stu-id="0bd5f-138">CRT runs the fiscal document provider that generates a fiscal document (for example, an XML document) that represents the transaction or event.</span></span>
5. <span data-ttu-id="0bd5f-139">Myyntipiste lähettää CRT:n valmisteleman kirjanpitoasiakirjan Hardware station -laajennukseen.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-139">The POS sends the fiscal document that CRT prepares to a Hardware station.</span></span>
6. <span data-ttu-id="0bd5f-140">Hardware station suorittaa kirjanpidon yhdistimen, joka käsittelee kirjanpitoasiakirjan ja välittää sen kirjanpidon laitteeseen tai palveluun.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-140">The Hardware station runs the fiscal connector that processes the fiscal document and communicates it to the fiscal device or service.</span></span>
7. <span data-ttu-id="0bd5f-141">Myyntipiste analysoi kirjanpidon laitteen ja palvelun vastauksen ja määrittää sen perusteella, onnistuiko kirjanpidon rekisteröinti.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-141">The POS analyzes the response from the fiscal device or service to determine whether the fiscal registration was successful.</span></span>
8. <span data-ttu-id="0bd5f-142">CRT tallentaa vastauksen kanavatietokantaan.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-142">CRT saves the response to the channel database.</span></span>

<span data-ttu-id="0bd5f-143">![Ratkaisumalli](media/emea-fiscal-integration-solution.png "Ratkaisumalli")</span><span class="sxs-lookup"><span data-stu-id="0bd5f-143">![Solution schema](media/emea-fiscal-integration-solution.png "Solution schema")</span></span>

## <a name="error-handling"></a><span data-ttu-id="0bd5f-144">Virheen käsittely</span><span class="sxs-lookup"><span data-stu-id="0bd5f-144">Error handling</span></span>

<span data-ttu-id="0bd5f-145">Kirjanpidon integrointikehikossa on seuraavat asetukset, joilla voi käsitellä kirjanpidon rekisteröinnin aikana tapahtuvia virheitä:</span><span class="sxs-lookup"><span data-stu-id="0bd5f-145">The fiscal integration framework provides the following options to handle failures during fiscal registration:</span></span>

- <span data-ttu-id="0bd5f-146">**Yritä uudelleen** – Käyttäjät voivat käyttää tätä asetusta, kun virhe voidaan ratkaista nopeasti ja kirjanpidon rekisteröinti voidaan suorittaa uudelleen.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-146">**Retry** – Operators can use this option when the failure can be resolved quickly, and the fiscal registration can be rerun.</span></span> <span data-ttu-id="0bd5f-147">Tätä asetusta voi käyttää esimerkiksi silloin, kun kirjanpidon laitetta ei ole liitetty, kuittitulostimessa ei ole paperia tai kuittitulostimessa on paperitukos.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-147">For example, this option can be used when the fiscal device isn't connected, the fiscal printer is out of paper, or there is a paper jam in the fiscal printer.</span></span>
- <span data-ttu-id="0bd5f-148">**Peruuta** – Käyttäjät voivat siirtää tällä asetuksella nykyisen transaktion tai tapahtuman kirjanpidon rekisteröinnin myöhemmäksi, jos se epäonnistuu.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-148">**Cancel** – This option lets operators postpone the fiscal registration of the current transaction or event if it fails.</span></span> <span data-ttu-id="0bd5f-149">Kun rekisteröintiä on siirretty myöhemmäksi, käyttäjä voi jatkaa työskentelyä myyntipisteessä ja suorittaa loppuun toiminnot, joissa kirjanpidon rekisteröintiä ei tarvita.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-149">After the registration is postponed, the operator can continue to work on the POS and can complete any operation that the fiscal registration isn't required for.</span></span> <span data-ttu-id="0bd5f-150">Kun myyntipisteessä tapahtuu kirjanpidon rekisteröintiä edellyttävä tapahtuma (avataan esimerkiksi uusi tapahtuma), virheen käsittelyn valintaikkuna avautuu automaattisesti ilmoittamaan, että edellistä tapahtumaan eri rekisteröity oikein. Valintaikkunassa on myös vaihtoehtoja virheen käsittelemiseen.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-150">When any event that requires the fiscal registration occurs in the POS (for example, a new transaction is opened), the error handling dialog box automatically appears to notify the operator that the previous transaction wasn't correctly registered and to provide the error handling options.</span></span>
- <span data-ttu-id="0bd5f-151">**Ohita** – Käyttäjä voi käyttää tätä asetusta, kun kirjanpidon rekisteröinti voidaan jättää tekemättä tietyissä tilanteissa ja tavallisia toimintoja voidaan jatkaa myyntipisteessä.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-151">**Skip** – Operators can use this option when the fiscal registration can be omitted under specific conditions and regular operations can be continued on the POS.</span></span> <span data-ttu-id="0bd5f-152">Tätä asetusta voidaan käyttää esimerkiksi silloin, kun se myyntitapahtuma, jonka kirjanpidon rekisteröinti epäonnistui, voidaan rekisteröidä erityiseen painettuun kirjauskansioon.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-152">For example, this option can be used when a sales transaction that the fiscal registration failed for can be registered in a special paper journal.</span></span>
- <span data-ttu-id="0bd5f-153">**Merkitse rekisteröidyksi** – käyttäjät voivat käyttää tätä asetusta, kun tapahtuma kyllä rekisteröitiin kirjanpidon laitteeseen (esimerkiksi verokuitti tulostettiin), mutta virhe tapahtui, kun kirjanpidon vastausta tallennettiin kanavatietokantaan.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-153">**Mark as registered** – Operators can use this option when the transaction was actually registered in the fiscal device (for example, a fiscal receipt was printed), but a failure occurred when the fiscal response was being saved to the channel database.</span></span>

> [!NOTE]
> <span data-ttu-id="0bd5f-154">**Ohita**- ja **Merkitse rekisteröidyksi** -asetukset on aktivoitava kirjanpidon rekisteröintiprosessissa ennen käyttöä.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-154">The **Skip** and **Mark as registered** options must be activated in the fiscal registration process before they are used.</span></span> <span data-ttu-id="0bd5f-155">Käyttäjille on myös myönnettävä vastaavat käyttöoikeudet.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-155">In addition, corresponding permissions must be granted to operators.</span></span>

<span data-ttu-id="0bd5f-156">**Ohita**- ja **Merkitse rekisteröidyksi** -asetuksella otetaan käyttöön tietokoodit taltioimaan tiettyjä virhettä koskevia tietoja, kuten virheen syy tai oikeutus kirjanpidon rekisteröinnin ohittamiselle tai tapahtuman merkitsemiselle rekisteröidyksi.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-156">The **Skip** and **Mark as registered** options enable info codes to capture some specific information about the failure, such as the reason for the failure or a justification for skipping the fiscal registration or marking the transaction as registered.</span></span> <span data-ttu-id="0bd5f-157">Lisätietoja virheen käsittelyparametrien määrittämisestä on kohdassa [Virheen käsittelyasetusten määrittäminen](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="0bd5f-157">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="optional-fiscal-registration"></a><span data-ttu-id="0bd5f-158">Valinnainen kirjanpidon rekisteröinti</span><span class="sxs-lookup"><span data-stu-id="0bd5f-158">Optional fiscal registration</span></span>

<span data-ttu-id="0bd5f-159">Kirjanpidon rekisteröinti voi olla pakollisista joillekin toiminnoille mutta valinnaista toisille.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-159">Fiscal registration might be mandatory for some operations but optional for others.</span></span> <span data-ttu-id="0bd5f-160">Tavallisen myynnin ja palautusten kirjanpidon rekisteröinti voi olla pakollista, kun taas asiakkaan talletuksiin liittyvien toimintojen kirjanpidon rekisteröinti voi olla valinnaista.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-160">For example, the fiscal registration of regular sales and returns might be mandatory, but the fiscal registration of operations that are related to customer deposits might be optional.</span></span> <span data-ttu-id="0bd5f-161">Tässä tapauksessa myynnin kirjanpidon rekisteröinnin tekemättä jättäminen estää lisämyynnin, kun taas asiakkaan tallennuksen kirjanpidon rekisteröinnin tekemättä jättäminen ei estä lisämyyntiä.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-161">In this case, failure to complete the fiscal registration of a sale should block further sales, but failure to complete the fiscal registration of a customer deposit should not block further sales.</span></span> <span data-ttu-id="0bd5f-162">Pakollisten ja valinnaisten toimintojen erottamiseksi suositellaan, että ne käsitellään eri asiakirjatoimittajissa ja että kyseisille toimittajille määritetään erilliset kirjanpidon rekisteröintiprosessin vaiheet.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-162">To distinguish mandatory and optional operations, we recommend that you handle them through different document providers, and that you set up separate steps in the fiscal registration process for those providers.</span></span> <span data-ttu-id="0bd5f-163">**Jatka virheen ilmetessä** -parametri on otettava käyttöön kaikissa valinnaiseen kirjanpidon rekisteröintiin liittyvissä vaiheissa.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-163">The **Continue on error** parameter should be enabled for any step that is related to optional fiscal registration.</span></span> <span data-ttu-id="0bd5f-164">Lisätietoja virheen käsittelyparametrien määrittämisestä on kohdassa [Virheen käsittelyasetusten määrittäminen](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="0bd5f-164">For more details about how to set up error handling parameters, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

### <a name="manually-running-fiscal-registration"></a><span data-ttu-id="0bd5f-165">Kirjanpidon rekisteröinnin suorittaminen manuaalisesti</span><span class="sxs-lookup"><span data-stu-id="0bd5f-165">Manually running fiscal registration</span></span>

<span data-ttu-id="0bd5f-166">Jos transaktion tai tapahtuman kirjanpidon rekisteröinti on lykätty virheen jälkeen (esimerkiksi silloin, kun toimittaja on valinnut **Peruuta** virheen käsittely valintaruudussa), voit suorittaa kirjanpidon rekisteröinnin manuaalisesti käynnistämällä vastaavan toiminnon.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-166">If the fiscal registration of a transaction or event has been postponed after a failure (for example, if the operator selected **Cancel** in the error handling dialog box), you can manually rerun the fiscal registration by invoking a corresponding operation.</span></span> <span data-ttu-id="0bd5f-167">Lisätietoja on kohdassa [Lykätyn kirjanpidon rekisteröinnin manuaalisen suorittamisen ottaminen käyttöön](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).</span><span class="sxs-lookup"><span data-stu-id="0bd5f-167">For more details, see [Enable manual execution of postponed fiscal registration](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).</span></span>

### <a name="fiscal-registration-health-check"></a><span data-ttu-id="0bd5f-168">Kirjanpidon rekisteröinnin kuntotarkastus</span><span class="sxs-lookup"><span data-stu-id="0bd5f-168">Fiscal registration health check</span></span>

<span data-ttu-id="0bd5f-169">Kirjanpidon rekisteröintien kuntotarkastusmenettely tarkistaa, että kirjanpidon laite tai palvelu on käytettävissä tietyn tapahtuman tapahtuessa.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-169">The health check procedure for fiscal registrations verifies the availability of the fiscal device or service when specific events occur.</span></span> <span data-ttu-id="0bd5f-170">Jos kirjanpidon rekisteröintiä ei suorittaa tällä hetkellä loppuun, käyttäjälle ilmoitetaan siitä etukäteen.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-170">If the fiscal registration can't currently be completed, the operator is notified in advance.</span></span>

<span data-ttu-id="0bd5f-171">Myyntipiste suorittaa kuntotarkastuksen seuraavien tapahtumien yhteydessä:</span><span class="sxs-lookup"><span data-stu-id="0bd5f-171">The POS runs the health check when the following events occur:</span></span>

- <span data-ttu-id="0bd5f-172">Uusi tapahtuma avataan.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-172">A new transaction is opened.</span></span>
- <span data-ttu-id="0bd5f-173">Keskeytettyä tapahtumaa jatketaan.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-173">A suspended transaction is recalled.</span></span>
- <span data-ttu-id="0bd5f-174">Myynti- tai palautustapahtuma viimeistellään.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-174">A sales or return transaction is finalized.</span></span>

<span data-ttu-id="0bd5f-175">Jos kuntotarkastus epäonnistuu, kuntotarkastuksen valintaikkuna avautuu myyntipisteeseen.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-175">If the health check fails, the POS shows the health check dialog box.</span></span> <span data-ttu-id="0bd5f-176">Valintaikkunassa on seuraavat painikkeet:</span><span class="sxs-lookup"><span data-stu-id="0bd5f-176">This dialog box provides the following buttons:</span></span>

- <span data-ttu-id="0bd5f-177">**OK** – Toimittaja voi ohittaa tällä painikkeella kuntotarkastuksen virheen ja jatkaa toiminnon käsittelyä.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-177">**OK** – This button lets the operator ignore a health check error and continue to process the operation.</span></span> <span data-ttu-id="0bd5f-178">Käyttäjät voivat valita tämän painikkeen vain, jos **Salli kuntotarkistuksen virheen ohitus** -käyttöoikeus on otettu heille käyttöön.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-178">Operators can select this button only if the **Allow skip health check error** permission is enabled for them.</span></span>
- <span data-ttu-id="0bd5f-179">**Peruuta** – Jos käyttäjä valitsee tämän painikkeen, myyntipiste peruuttaa viimeisimmän toiminnon. (Nimikettä ei esimerkiksi lisätä uuteen toimintoon.)</span><span class="sxs-lookup"><span data-stu-id="0bd5f-179">**Cancel** – If the operator selects this button, the POS cancels the last action (for example, an item isn't added to a new transaction).</span></span>

> [!NOTE]
> <span data-ttu-id="0bd5f-180">Kuntotarkastus suorittaan vain, jos nykyinen toiminto edellyttää kirjanpidon rekisteröintiä ja jos **Jatka virheen ilmetessä** -parametri on poistettu kirjanpidon rekisteröintiprosessin nykyisessä vaiheessa käytöstä.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-180">The health check is run only if the current operation requires fiscal registration, and if  the **Continue on error** parameter is disabled for the current step of the fiscal registration process.</span></span> <span data-ttu-id="0bd5f-181">Lisätietoja on kohdassa [Virheen käsittelyasetusten määrittäminen](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span><span class="sxs-lookup"><span data-stu-id="0bd5f-181">For more details, see [Set error handling settings](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).</span></span>

## <a name="storing-fiscal-response-in-fiscal-transaction"></a><span data-ttu-id="0bd5f-182">Kirjanpidon vastauksen tallentaminen kirjanpitotapahtumassa</span><span class="sxs-lookup"><span data-stu-id="0bd5f-182">Storing fiscal response in fiscal transaction</span></span>

<span data-ttu-id="0bd5f-183">Kun transaktion tai tapahtuman kirjanpidon rekisteröinti onnistuu, kirjanpitotapahtuma luodaan kanavatietokannassa ja linkitetään alkuperäiseen transaktioon tai tapahtumaan.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-183">When fiscal registration of a transaction or event is successful, a fiscal transaction is created in the channel database and linked to the original transaction or event.</span></span> <span data-ttu-id="0bd5f-184">Vastaavasti jos epäonnistuneelle kirjanpidon rekisteröinnille valitaan **Ohita**- tai **Merkitse rekisteröidyksi** -asetus, tämä tieto tallennetaan kirjanpitotapahtumaan.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-184">Similarly, if the **Skip** or **Mark as registered** option is selected for a failed fiscal registration, this information is stored in a fiscal transaction.</span></span> <span data-ttu-id="0bd5f-185">Kirjanpitotapahtuma säilyttää kirjanpidon laitteen tai palvelun kirjanpidon vastauksen.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-185">A fiscal transaction holds the fiscal response of the fiscal device or service.</span></span> <span data-ttu-id="0bd5f-186">Jos kirjanpidon rekisteröintiprosessissa on useita vaiheita, kirjanpitotapahtuma luodaan jokaiselle prosessin vaiheelle, jonka seurauksena oli onnistunut tai epäonnistunut rekisteröinti.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-186">If the fiscal registration process consists of several steps, a fiscal transaction is created for each step of the process that resulted in a successful or failed registration.</span></span>

<span data-ttu-id="0bd5f-187">*P-työ* siirtää kirjanpitotapahtumat Headquartersiin yhdessä vähittäismyyntitapahtumien kanssa.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-187">Fiscal transactions are transferred to Headquarters by the *P-job*, together with transactions.</span></span> <span data-ttu-id="0bd5f-188">Voit tarkastella **Myymälän tapahtumat** -sivun **Tilikauden tapahtumat** -pikavälilehdellä tapahtumiin linkitettyjä kirjanpitotapahtumia.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-188">On the **Fiscal transactions** FastTab of the **Store transactions** page, you can view the fiscal transactions that are linked to transactions.</span></span>

<span data-ttu-id="0bd5f-189">Kirjanpitotapahtumaan tallennetaan seuraavat tiedot:</span><span class="sxs-lookup"><span data-stu-id="0bd5f-189">A fiscal transaction stores the following details:</span></span>

- <span data-ttu-id="0bd5f-190">Kirjanpidon rekisteröintiprosessin tiedot (kuten prosessi, yhdistinryhmä ja yhdistin).</span><span class="sxs-lookup"><span data-stu-id="0bd5f-190">Fiscal registration process details (process, connector group, connector, and so on).</span></span> <span data-ttu-id="0bd5f-191">Siihen tallennetaan myös **Kassakoneen numero** -kentässä oleva kirjanpidon laitteen sarjanumero, jos tämä tieto sisältyy kirjanpidon vastaukseen.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-191">It also stores the serial number of the fiscal device in the **Register number** field, if this information is included in the fiscal response.</span></span>
- <span data-ttu-id="0bd5f-192">Kirjanpidon rekisteröinnin tila: **Valmis**, jos rekisteröinti onnistui, **Ohitettu**, jos käyttäjä valitsi epäonnistuneessa rekisteröinnissä **Ohita**-asetuksen, tai **Merkitty rekisteröidyksi**, jos käyttäjä valitse **Merkitse rekisteröidyksi** -asetuksen.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-192">The status of the fiscal registration: **Completed** for successful registration, **Skipped** if the operator selected the **Skip** option for a failed registration, or **Marked as registered** if the operator selected the **Mark as registered** option.</span></span>
- <span data-ttu-id="0bd5f-193">Valittuun kirjanpitotapahtumaan liittyvät tietokooditapahtumat.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-193">Info code transactions that are related to a selected fiscal transaction.</span></span> <span data-ttu-id="0bd5f-194">Voit tarkastella tietokooditapahtumia valitsemalla **Tilikauden tapahtumat** -pikavälilehdessä ensin kirjanpitotapahtuman, jonka tila on **Ohitettu** tai **Merkitty rekisteröidyksi**, ja sitten **Tietokooditapahtumat**.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-194">To view the info code transactions, on the **Fiscal transactions** FastTab, select a fiscal transaction that has a status of **Skipped** or **Marked as registered**, and then select **Info code transactions**.</span></span>

## <a name="fiscal-texts-for-discounts"></a><span data-ttu-id="0bd5f-195">Alennusten kirjanpitotekstit</span><span class="sxs-lookup"><span data-stu-id="0bd5f-195">Fiscal texts for discounts</span></span>

<span data-ttu-id="0bd5f-196">Joissakin maissa tai joillakin alueilla on verokuitteihin tulostettavia lisätekstejä koskevia erityisvaatimuksia, kuten käytössä on erilaisia alennuksia.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-196">Some countries or regions have special requirements about additional texts that must be printed on fiscal receipts when different kinds of discounts are applied.</span></span> <span data-ttu-id="0bd5f-197">Kirjanpidon integrointitoiminnolla voi määrittää alennusta koskevan erityistekstin, joka tulostetaan verokuitin alennusrivin jälkeen.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-197">The fiscal integration functionality lets you set up a special text for a discount that is printed after a discount line on a fiscal receipt.</span></span> <span data-ttu-id="0bd5f-198">Jos kyse on manuaalisesti tehtävistä alennuksista, voit määrittää tietokoodin kirjanpitotekstin myyntipisteen toimintaprofiilissa **Tuotealennus**-tietokoodina.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-198">For manual discounts, you can configure a fiscal text for the info code that is specified as the **Product discount** info code in the POS functionality profile.</span></span> <span data-ttu-id="0bd5f-199">Lisätietoja alennusten kirjanpitotekstin määrittämisestä on kohdassa [Alennusten kirjanpitotekstien määrittäminen](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).</span><span class="sxs-lookup"><span data-stu-id="0bd5f-199">For more details about how to set up fiscal texts for discounts, see [Set up fiscal texts for discounts](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).</span></span>

## <a name="printing-fiscal-x-and-fiscal-z-reports"></a><span data-ttu-id="0bd5f-200">Kuitti X- ja kuitti Z -raporttien tulostaminen</span><span class="sxs-lookup"><span data-stu-id="0bd5f-200">Printing fiscal X and fiscal Z reports</span></span>

<span data-ttu-id="0bd5f-201">Kirjanpidon integrointitoiminto tukee tiettyä integroidun kirjanpidon laitetta tai palvelua koskevan päivän lopun laskelmien luontia:</span><span class="sxs-lookup"><span data-stu-id="0bd5f-201">Fiscal integration functionality supports generation of end-of-day statements that are specific to the integrated fiscal device or service:</span></span>

- <span data-ttu-id="0bd5f-202">Uudet painikkeet, joilla kyseiset toiminnot suoritetaan, on lisättävä myyntipisteen näyttöasetteluun.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-202">New buttons that run corresponding operations should be added to the POS screen layout.</span></span> <span data-ttu-id="0bd5f-203">Lisätietoja on kohdassa [Kirjanpidon X/Z-raporttien määrittäminen myyntipisteessä](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).</span><span class="sxs-lookup"><span data-stu-id="0bd5f-203">For more details, see [Set up fiscal X/Z reports from the POS](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).</span></span>
- <span data-ttu-id="0bd5f-204">Kirjanpidon integrointimallissa nämä toiminnot on täsmäytettävä kirjanpidon laitteen vastaaviin toimintoihin.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-204">In the fiscal integration sample, these operations should be matched to the corresponding operations of the fiscal device.</span></span>

## <a name="fiscal-integration-samples-in-the-retail-sdk"></a><span data-ttu-id="0bd5f-205">Retail SDK:n kirjanpidon integrointimallit</span><span class="sxs-lookup"><span data-stu-id="0bd5f-205">Fiscal integration samples in the Retail SDK</span></span>

<span data-ttu-id="0bd5f-206">Seuraavat kirjanpidon integrointimallit ovat käytettävissä Retail SDK:ssa:</span><span class="sxs-lookup"><span data-stu-id="0bd5f-206">The following fiscal integration samples are currently available in the Retail SDK:</span></span>

- [<span data-ttu-id="0bd5f-207">Näyte verotusta varten olevan tulostimen integroinnista Italiassa</span><span class="sxs-lookup"><span data-stu-id="0bd5f-207">Fiscal printer integration sample for Italy</span></span>](emea-ita-fpi-sample.md)
- [<span data-ttu-id="0bd5f-208">Näyte verotusta varten olevan tulostimen integroinnista Puolassa</span><span class="sxs-lookup"><span data-stu-id="0bd5f-208">Fiscal printer integration sample for Poland</span></span>](emea-pol-fpi-sample.md)
- [<span data-ttu-id="0bd5f-209">Itävallan tilikausirekisteröintipalvelun integroinnin malli</span><span class="sxs-lookup"><span data-stu-id="0bd5f-209">Fiscal registration service integration sample for Austria</span></span>](emea-aut-fi-sample.md)
- [<span data-ttu-id="0bd5f-210">Tšekin tasavallan tilikausirekisteröintipalvelun integroinnin malli</span><span class="sxs-lookup"><span data-stu-id="0bd5f-210">Fiscal registration service integration sample for Czech Republic</span></span>](emea-cze-fi-sample.md)
- [<span data-ttu-id="0bd5f-211">Tarkistusyksikön integrointimalli – Ruotsi</span><span class="sxs-lookup"><span data-stu-id="0bd5f-211">Control unit integration sample for Sweden</span></span>](./emea-swe-fi-sample.md)
- [<span data-ttu-id="0bd5f-212">Saksan tilikausirekisteröintipalvelun integroinnin malli</span><span class="sxs-lookup"><span data-stu-id="0bd5f-212">Fiscal registration service integration sample for Germany</span></span>](./emea-deu-fi-sample.md)

<span data-ttu-id="0bd5f-213">Myös seuraava kirjanpidon integrointitoiminto on käytettävissä Retail SDK:ssa, mutta se ei tällä hetkellä käytä kirjanpidon integrointikehikkoa.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-213">The following fiscal integration functionality is also available in the Retail SDK but doesn't currently take advantage of the fiscal integration framework.</span></span> <span data-ttu-id="0bd5f-214">Tämä toiminto on tarkoitus siirtää kirjanpidon integrointikehikkoon myöhemmissä päivityksissä.</span><span class="sxs-lookup"><span data-stu-id="0bd5f-214">Migration of this functionality to the fiscal integration framework is planned for later updates.</span></span>


- [<span data-ttu-id="0bd5f-215">Digitaalinen allekirjoitus Ranskassa</span><span class="sxs-lookup"><span data-stu-id="0bd5f-215">Digital signature for France</span></span>](emea-fra-cash-registers.md)
- [<span data-ttu-id="0bd5f-216">Digitaalinen allekirjoitus Norjassa</span><span class="sxs-lookup"><span data-stu-id="0bd5f-216">Digital signature for Norway</span></span>](emea-nor-cash-registers.md)

<span data-ttu-id="0bd5f-217">Seuraava vanha kirjanpidon integrointitoiminto, joka on käytettävissä Retail SDK -versiossa, ei käytä kirjanpidon integrointikehystä, ja se poistetaan käytöstä myöhemmissä päivityksissä:</span><span class="sxs-lookup"><span data-stu-id="0bd5f-217">The following legacy fiscal integration functionality that is available in Retail SDK does not use the fiscal integration framework and will be deprecated in later updates:</span></span>

- [<span data-ttu-id="0bd5f-218">Tarkistusyksikön integrointimalli – Ruotsi (vanha)</span><span class="sxs-lookup"><span data-stu-id="0bd5f-218">Control unit integration sample for Sweden (legacy)</span></span>](./retail-sdk-control-unit-sample.md)
